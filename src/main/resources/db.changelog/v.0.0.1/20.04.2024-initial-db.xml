<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.3.xsd">

    <!-- Table User -->
    <changeSet id="create_table_user" author="andreynachevnyy">
        <createTable tableName="User_db">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="patronymic" type="VARCHAR(255)"/>
            <column name="Last_name" type="VARCHAR(255)"/>
            <column name="id_card" type="BIGINT"/>
            <column name="id_role" type="INTEGER"/>
            <column name="id_transaction" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Table Event -->
    <changeSet id="create_table_event" author="andreynachevnyy">
        <createTable tableName="Event">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="time_start" type="TIMESTAMP"/>
            <column name="id_category" type="BIGINT"/>
            <column name="id_age_category" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Table Category -->
    <changeSet id="create_table_Category" author="andreynachevnyy">
        <createTable tableName="Category" >
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- Table Age_Category -->
    <changeSet id="create_table_Age_Category" author="andreynachevnyy">
        <createTable tableName="Age_category">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- Table Card -->
    <changeSet id="create_table_card" author="andreynachevnyy">
        <createTable tableName="Card">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(255)"/>
            <column name="balance" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Table Transaction -->
    <changeSet id="create_table_Transaction" author="andreynachevnyy">
        <createTable tableName="Transaction">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="value" type="INTEGER"/>
            <column name="time" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <!-- Table Role -->
    <changeSet id="create_table_Role" author="andreynachevnyy">
        <createTable tableName="Role">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- Table user_event_mapping -->
    <changeSet id="create_table_user_event_mapping" author="andreynachevnyy">
        <createTable tableName="User_event">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="id_event" type="BIGINT"/>
            <column name="id_user" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Table Suggestion -->
    <changeSet id="create_table_Suggestion" author="andreynachevnyy">
        <createTable tableName="Suggestion">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="image" type="BLOB"/>
            <column name="header" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- Table user_suggestion_mapping -->
    <changeSet id="create_table_user_suggestion_mapping" author="andreynachevnyy">
        <createTable tableName="User_suggestion">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="id_suggestion" type="INTEGER"/>
            <column name="id_user" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- Foreign Keys -->
    <changeSet id="add_foreign_keys" author="andreynachevnyy">
        <addForeignKeyConstraint baseTableName="User_db" baseColumnNames="id_card"
                                 constraintName="FK_user_card" referencedTableName="Card"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_db" baseColumnNames="id_role"
                                 constraintName="FK_user_role" referencedTableName="Role"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_db" baseColumnNames="id_transaction"
                                 constraintName="FK_user_transaction" referencedTableName="Transaction"
                                 referencedColumnNames="id" deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION" validate="true"/>
        <addForeignKeyConstraint baseTableName="Event" baseColumnNames="id_category"
                                 constraintName="FK_event_category" referencedTableName="Category"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="Event" baseColumnNames="id_age_category"
                                 constraintName="FK_Event_age_category" referencedTableName="Age_category"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_event" baseColumnNames="id_event"
                                 constraintName="FK_user_event" referencedTableName="Event"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_event" baseColumnNames="id_user"
                                 constraintName="FK_user_event_User" referencedTableName="User_db"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_suggestion" baseColumnNames="id_suggestion"
                                 constraintName="FK_user_suggestion" referencedTableName="Suggestion"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
        <addForeignKeyConstraint baseTableName="User_suggestion" baseColumnNames="id_user"
                                 constraintName="FK_user_suggestion_User" referencedTableName="User_db"
                                 deferrable="false" initiallyDeferred="false"
                                 onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="id" validate="true"/>
    </changeSet>

</databaseChangeLog>